<div class="container mx-auto mt-10">
  <h1 class="text-2xl font-bold mb-4">Scroll Depth by Page</h1>
  <canvas id="scrollChart" height="120"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("turbo:load", () => {
  fetch("<%= scroll_stats_analytics_path(format: :json) %>")
    .then(r => r.json())
    .then(data => {
      const ctx = document.getElementById("scrollChart");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(d => d.url),
          datasets: [{
            label: 'Average Scroll %',
            data: data.map(d => d.avg_scroll),
            borderWidth: 1,
            backgroundColor: 'rgba(75, 192, 192, 0.5)'
          }]
        },
        options: {
          scales: { y: { beginAtZero: true, max: 100 } },
          plugins: {
            legend: { display: false },
            tooltip: { callbacks: {
              label: ctx => `${ctx.parsed.y}% average scroll`
            }}
          }
        }
      });
    });
});
</script>
